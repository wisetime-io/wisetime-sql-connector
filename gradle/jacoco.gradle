
ext {
    jcLineMin = 0.94
    jcClassMin = 0.99

    jacocoExcludes = [
            'com/google/**',
            '**/generated/**',
            '**/endpoints/**',
            '**/grpc_client/**',
            '**/Immutable*',
            '**/config/**',
            '**/*Server*',
            '**/*Wrapper*',
            '**/*Provider*',
            '**/*Module*',
            '**/*Launcher*',
            '**/*Client*'
    ]
}

jacocoTestCoverageVerification {
    sourceDirectories.from jacocoTestReport.sourceDirectories
    classDirectories.from jacocoTestReport.classDirectories
    afterEvaluate {
        classDirectories.from = files(classDirectories.files.collect {
            fileTree(dir: it, exclude: jacocoExcludes)
        })
    }

    violationRules {
        rule {
            element = 'BUNDLE'
            limit {
                counter = 'LINE'
                minimum = jcLineMin
            }
        }
        rule {
            element = 'BUNDLE'
            limit {
                counter = 'CLASS'
                minimum = jcClassMin
            }
        }
    }
}
